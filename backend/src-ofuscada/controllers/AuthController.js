(function(_0x5b5777,_0x170703){const _0x5330fe=a1_0x4052,_0x8dca82=_0x5b5777();while(!![]){try{const _0x7ab294=parseInt(_0x5330fe(0xea))/0x1*(-parseInt(_0x5330fe(0xe1))/0x2)+parseInt(_0x5330fe(0xf4))/0x3+parseInt(_0x5330fe(0xd8))/0x4+parseInt(_0x5330fe(0xd7))/0x5+parseInt(_0x5330fe(0xee))/0x6*(-parseInt(_0x5330fe(0xf1))/0x7)+parseInt(_0x5330fe(0xe9))/0x8+parseInt(_0x5330fe(0xe4))/0x9*(-parseInt(_0x5330fe(0xdb))/0xa);if(_0x7ab294===_0x170703)break;else _0x8dca82['push'](_0x8dca82['shift']());}catch(_0x1f2fc6){_0x8dca82['push'](_0x8dca82['shift']());}}}(a1_0x152c,0x90e99));import{Users}from'../models/Users.js';import{Account}from'../models/Account.js';import a1_0x3b9c6d from'bcrypt';import{createAccessToken,getHeaderToken,verifyJWT}from'../libs/jwt.js';function a1_0x152c(){const _0x2c88b8=['\x20con\x20CI:\x20','2457755OxnCEr','2250392mLkhDl','log','compare','11980ASJBWu','User\x20auth','status','json','headers','firstName','39982auiVTz','Datos\x20incorrectos','name','1467xKwxoD','method','originalUrl','Unauthorized','findOne','4880856QLTSUf','40jImrQD','body','message','Se\x20a\x20Logeado\x20al\x20Sistema','349158wqXhZv','password','user-agent','21XcJTfr','user','role','296394EHeclO'];a1_0x152c=function(){return _0x2c88b8;};return a1_0x152c();}import{Roles}from'../models/Roles.js';function a1_0x4052(_0x18af81,_0x3cceff){const _0x152c86=a1_0x152c();return a1_0x4052=function(_0x4052e3,_0x541a99){_0x4052e3=_0x4052e3-0xd6;let _0x323a89=_0x152c86[_0x4052e3];return _0x323a89;},a1_0x4052(_0x18af81,_0x3cceff);}import{logger}from'../log/LogActivity.js';export const login=async(_0x4d4606,_0x36e828)=>{const _0x4afeb5=a1_0x4052,{username:_0x15c4ea,password:_0x593062}=_0x4d4606[_0x4afeb5(0xeb)],_0xdb9f1d=_0x4d4606[_0x4afeb5(0xdf)][_0x4afeb5(0xf0)];try{const _0x5c101f=await Account[_0x4afeb5(0xe8)]({'where':{'username':_0x15c4ea},'include':[{'model':Roles,'as':_0x4afeb5(0xf3)},{'model':Users,'as':_0x4afeb5(0xf2)}]});if(!_0x5c101f)return _0x36e828['status'](0x190)[_0x4afeb5(0xde)]({'message':_0x4afeb5(0xe2)});const _0x3d74c7=await a1_0x3b9c6d[_0x4afeb5(0xda)](_0x593062,_0x5c101f[_0x4afeb5(0xef)]);if(!_0x3d74c7)return _0x36e828['status'](0x190)[_0x4afeb5(0xde)]({'message':_0x4afeb5(0xe2)});const _0x15c226={'userId':_0x5c101f['userId'],'loginRol':_0x5c101f['role'][_0x4afeb5(0xe3)],'rolId':_0x5c101f['role']['id'],'accountId':_0x5c101f['id']},_0x5b5210=await createAccessToken({'payload':_0x15c226}),_0x4b3215=_0x5c101f['user'];logger({'httpMethod':_0x4d4606[_0x4afeb5(0xe5)],'endPoint':_0x4d4606[_0x4afeb5(0xe6)],'action':_0x4afeb5(0xed),'description':'EL\x20'+_0x5c101f['role'][_0x4afeb5(0xe3)]+'\x20'+_0x4b3215[_0x4afeb5(0xe0)]+'\x20'+_0x4b3215['secondName']+'\x20'+_0x4b3215['firstLastName']+'\x20'+_0x4b3215['secondLastName']+_0x4afeb5(0xd6)+_0x4b3215['ci'],'system':_0xdb9f1d}),_0x36e828[_0x4afeb5(0xde)]({'message':_0x4afeb5(0xdc),'token':_0x5b5210});}catch(_0x5a761c){_0x36e828['status'](0x1f4)[_0x4afeb5(0xde)]({'message':_0x5a761c[_0x4afeb5(0xec)]}),console[_0x4afeb5(0xd9)](_0x5a761c);}};export const verifytoken=async(_0x405610,_0x368130)=>{const _0x5b328d=a1_0x4052;try{const _0x28b4d6=getHeaderToken(_0x405610);if(!_0x28b4d6)return _0x368130['status'](0x191)[_0x5b328d(0xde)]({'message':'Unauthorized'});const _0x1dce21=await verifyJWT(_0x28b4d6);_0x368130[_0x5b328d(0xde)](_0x1dce21);}catch(_0x57ac8c){return _0x368130[_0x5b328d(0xdd)](0x191)[_0x5b328d(0xde)]({'message':_0x5b328d(0xe7)});}};