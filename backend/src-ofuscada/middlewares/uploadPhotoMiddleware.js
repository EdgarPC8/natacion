const a13_0x3219e3=a13_0xa3cf;(function(_0x4f9ba5,_0x1d19eb){const _0x49fda0=a13_0xa3cf,_0x14f398=_0x4f9ba5();while(!![]){try{const _0x31a5b9=parseInt(_0x49fda0(0x1a7))/0x1+-parseInt(_0x49fda0(0x1ba))/0x2*(parseInt(_0x49fda0(0x1b8))/0x3)+parseInt(_0x49fda0(0x1b9))/0x4+parseInt(_0x49fda0(0x1a5))/0x5*(-parseInt(_0x49fda0(0x1aa))/0x6)+parseInt(_0x49fda0(0x1ad))/0x7+parseInt(_0x49fda0(0x1b0))/0x8+-parseInt(_0x49fda0(0x1a9))/0x9;if(_0x31a5b9===_0x1d19eb)break;else _0x14f398['push'](_0x14f398['shift']());}catch(_0x1025ad){_0x14f398['push'](_0x14f398['shift']());}}}(a13_0x1c84,0xd20e4));import a13_0xe2d9f2 from'multer';import{join,extname}from'path';import a13_0x298f27 from'../libs/file-dirname.js';import{unlink}from'fs/promises';import{Users}from'../Models/Users.js';const {__dirname}=a13_0x298f27(import.meta),photosDestination=join(__dirname,'../img/photos'),diskStorage=a13_0xe2d9f2[a13_0x3219e3(0x1ab)]({'destination':photosDestination,'filename':async(_0x36df8c,_0x19efcd,_0x4d619d)=>{const _0x2f5dda=a13_0x3219e3,_0x21cd44=_0x2f5dda(0x1ae)+_0x36df8c[_0x2f5dda(0x1b5)][_0x2f5dda(0x1ac)]+extname(_0x19efcd[_0x2f5dda(0x1b3)]);_0x4d619d(null,_0x21cd44),await Users[_0x2f5dda(0x1b2)]({'photo':_0x21cd44},{'where':{'id':_0x36df8c[_0x2f5dda(0x1b5)][_0x2f5dda(0x1ac)]}});}}),deletePhoto=async(_0x55cdb4,_0x52417b)=>{const _0x25adf6=a13_0x3219e3,{photo:_0x441554}=await Users['findOne']({'attributes':[_0x25adf6(0x1b1)],'where':{'id':_0x55cdb4[_0x25adf6(0x1b5)][_0x25adf6(0x1ac)]}});try{await unlink(join(photosDestination,_0x441554)),await Users[_0x25adf6(0x1b2)]({'photo':null},{'where':{'id':_0x55cdb4[_0x25adf6(0x1b5)][_0x25adf6(0x1ac)]}}),_0x52417b[_0x25adf6(0x1a8)]({'message':'Foto\x20de\x20Perfil\x20eleminada\x20con\x20éxito'});}catch(_0xff0982){return _0x441554==null?_0x52417b[_0x25adf6(0x1a6)](0x1f4)[_0x25adf6(0x1a8)]({'message':'No\x20existe\x20imagen\x20para\x20eliminar'}):_0x52417b[_0x25adf6(0x1a6)](0x1f4)[_0x25adf6(0x1a8)]({'message':_0xff0982['message']});}},upload=a13_0xe2d9f2({'storage':diskStorage})[a13_0x3219e3(0x1b4)]('photo'),uploadPhoto=(_0xba26,_0x4c4d2a)=>{upload(_0xba26,_0x4c4d2a,_0xd9049c=>{const _0x47a26a=a13_0xa3cf;if(_0xd9049c)return _0x4c4d2a[_0x47a26a(0x1a6)](0x1f4)[_0x47a26a(0x1a8)]({'message':_0x47a26a(0x1af)+_0xd9049c['message']});_0x4c4d2a[_0x47a26a(0x1a8)]({'message':_0x47a26a(0x1b6),'photo':_0xba26['file'][_0x47a26a(0x1b7)]});});};function a13_0x1c84(){const _0x2e4cba=['userPhotoProfileId','Error\x20al\x20subir\x20la\x20foto:\x20','9935560KLzRqw','photo','update','originalname','single','params','Foto\x20de\x20perfil\x20subida\x20con\x20éxito','filename','166137qZbawu','3519692kGjOjB','20VQxeRO','65qsFrMV','status','58999pVczhs','json','4711653uoaAWv','639480FeDHHx','diskStorage','userId','7996576KVEHBg'];a13_0x1c84=function(){return _0x2e4cba;};return a13_0x1c84();}function a13_0xa3cf(_0x4f2837,_0x541ef5){const _0x1c840f=a13_0x1c84();return a13_0xa3cf=function(_0xa3cf04,_0xabfc4b){_0xa3cf04=_0xa3cf04-0x1a5;let _0x52982f=_0x1c840f[_0xa3cf04];return _0x52982f;},a13_0xa3cf(_0x4f2837,_0x541ef5);}export{uploadPhoto,deletePhoto};